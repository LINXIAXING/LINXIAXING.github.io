


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>  Docker+FastApi微服务搭建 |    BLOG.</title>
  <meta name="description" content="A minimalist theme for hexo.">
  <!-- 标签页图标 -->
  
  <link rel="shortcut icon" href="/images/icon.png" type="image/x-icon">
  

  <!-- 图标库 https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css-->
  <!-- <link rel="stylesheet" href="css/remixicon.css"> -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css">
  <!-- 动画库 https://cdn.jsdelivr.net/gh/fushaolei/cdn-white@1.0/css/animate.css-->
  
  <link rel="stylesheet" href="css/animate.css">
  
  <!-- css文件 -->
  
<link rel="stylesheet" href="/css/white.css">

  <!-- 代码高亮 -->
  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>

<div class="menu-outer">
    <div class="menu-inner">
      <div class="menu-site-name  animate__animated  animate__fadeInUp">
        <a href="/">
          BLOG.
        </a>
        
      </div>
      <div class="menu-group">
        <ul class="menu-ul">
        
          <a href="/" class="nav-link">
            <li class="menu-li  animate__animated  animate__fadeInUp">
              HOME
            </li>
          </a>
        
          <a href="/archives" class="nav-link">
            <li class="menu-li  animate__animated  animate__fadeInUp">
              BLOG
            </li>
          </a>
        
          <a href="/categories" class="nav-link">
            <li class="menu-li  animate__animated  animate__fadeInUp">
              TAGS
            </li>
          </a>
        
          <a href="/friends" class="nav-link">
            <li class="menu-li  animate__animated  animate__fadeInUp">
              FRIENDS
            </li>
          </a>
        
          <a href="/about" class="nav-link">
            <li class="menu-li  animate__animated  animate__fadeInUp">
              ABOUT
            </li>
          </a>
        
        <!-- 
          <li class="menu-li animate__animated  animate__fadeInUp" id="sort">
             TAGS
             <div class="categories-outer " id="sort-div">
               <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/FastAPI/">FastAPI</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Test/">Test</a></li></ul>
             </div>
          </li>
         -->
        
        <a href="/search">
          <li class="menu-li  animate__animated  animate__fadeInUp">
            <i class="ri-search-line"></i>
          </li>
        </a>
        
          <li class="menu-li animate__animated  animate__fadeInUp" id="mobile-menu">
            <i class="ri-menu-line"></i>
          </li>
        
        </ul>

      </div>

    </div>
</div>
<div id="mobile-main" class="animate__animated  animate__fadeIn">
  <div class="mobile-menu-inner">
    <div class="mobile-menu-site-name animate__animated  animate__fadeInUp">
      <a href="/">
        BLOG.
      </a>
    </div>
    <div class="mobile-menu-group" id="mobile-close">
      <i class="ri-close-line"></i>
    </div>

  </div>

  <div class="mobile-menu-div">
  
    <a href="/" class="mobile-nav-link">
      <div class="mobile-menu-child animate__animated  animate__fadeInUp">
        <span>HOME</span>
      </div>
    </a>
  
    <a href="/archives" class="mobile-nav-link">
      <div class="mobile-menu-child animate__animated  animate__fadeInUp">
        <span>BLOG</span>
      </div>
    </a>
  
    <a href="/categories" class="mobile-nav-link">
      <div class="mobile-menu-child animate__animated  animate__fadeInUp">
        <span>TAGS</span>
      </div>
    </a>
  
    <a href="/friends" class="mobile-nav-link">
      <div class="mobile-menu-child animate__animated  animate__fadeInUp">
        <span>FRIENDS</span>
      </div>
    </a>
  
    <a href="/about" class="mobile-nav-link">
      <div class="mobile-menu-child animate__animated  animate__fadeInUp">
        <span>ABOUT</span>
      </div>
    </a>
  
  
    <a href="/search">  
      <div class="mobile-menu-child  animate__animated  animate__fadeInUp">
        <i class="ri-search-line"></i>
      </div>
    </a>
    
  </div>


</div>

<div class="body-outer">
  <div class="body-inner">
    
<article class="post-inner">
  <div class="post-content-outer">
    <div class="post-intro">
      <div class="post-title animate__animated  animate__fadeInUp">Docker+FastApi微服务搭建</div>
      <div class="meta-intro animate__animated  animate__fadeInUp">Jun 08 2023</div>
      
    </div>
    <div class="post-content-inner">
      <div class="post-content-inner-space">

      </div>
      <div class="post-content-main animate__animated  animate__fadeInUp">
        <!-- top型目录 -->
        
        <h1 id="Docker容器下基于Nginx-FastAPI的简易后台搭建"><a href="#Docker容器下基于Nginx-FastAPI的简易后台搭建" class="headerlink" title="Docker容器下基于Nginx + FastAPI的简易后台搭建"></a>Docker容器下基于Nginx + FastAPI的简易后台搭建</h1><blockquote>
<p>本教程仅包含</p>
</blockquote>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="基本思路"><a href="#基本思路" class="headerlink" title="基本思路"></a>基本思路</h3><p>Docker容器下通过Python fastapi库完成后台开发，Nginx对不同docker下的服务端口做映射，实现微服务开发。不同的镜像负责不同的功能模块，优点是低耦合高延展，且便于迁移（编写脚本实现一键打包与部署，此博客中暂时不做赘述）。</p>
<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p>Ubuntu 20.04</p>
<h2 id="Ⅰ-Docker环境搭建"><a href="#Ⅰ-Docker环境搭建" class="headerlink" title="Ⅰ.Docker环境搭建"></a>Ⅰ.Docker环境搭建</h2><blockquote>
<p>如果您已准备好容器，请忽略此步</p>
</blockquote>
<h3 id="1-Docker安装与配置"><a href="#1-Docker安装与配置" class="headerlink" title="1.Docker安装与配置"></a>1.Docker安装与配置</h3><h3 id="2-镜像创建与启用"><a href="#2-镜像创建与启用" class="headerlink" title="2.镜像创建与启用"></a>2.镜像创建与启用</h3><p>查看全部Docker容器的地址：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect -f &#x27;&#123;&#123;.Name&#125;&#125; - &#123;&#123;.NetworkSettings.IPAddress &#125;&#125;&#x27; $(docker ps -aq)</span><br></pre></td></tr></table></figure>

<p>如果是docker-compose，那么请使用命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect --format=&#x27;&#123;&#123;.Name&#125;&#125; - &#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27; $(docker ps -aq)</span><br></pre></td></tr></table></figure>





<h2 id="Ⅱ-基于FastApi的后台开发"><a href="#Ⅱ-基于FastApi的后台开发" class="headerlink" title="Ⅱ.基于FastApi的后台开发"></a>Ⅱ.基于FastApi的后台开发</h2><blockquote>
<p>FastApi是一个基于Python的高速web框架</p>
<p>关于更多建议查询<a target="_blank" rel="noopener" href="https://fastapi.tiangolo.com/zh/tutorial/">官方API</a>，推荐Python版本3.6+</p>
</blockquote>
<p>这里我已经写好一份简单的项目。他包含两个接口，通过深度学习模型实现 文字➡语音 和 语音➡文字功能。</p>
<p>如果要使用，那么你需要拥有基本的CUDA+Pytorch环境，或者你也可以仅做参考。</p>
<p>请访问我的Github仓库。</p>
<h2 id="Ⅲ-Nginx端口转发"><a href="#Ⅲ-Nginx端口转发" class="headerlink" title="Ⅲ.Nginx端口转发"></a>Ⅲ.Nginx端口转发</h2><p>在安装之前，你需要先确保你有安装先决条件</p>
<p>对于<code>Ubuntu</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt-get install gcc</span><br><span class="line">apt-get install libpcre3 libpcre3-dev</span><br><span class="line">apt-get install zlib1g zlib1g-dev</span><br><span class="line">apt-get install openssl openssl-dev</span><br></pre></td></tr></table></figure>

<p>对于<code>CentOS</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc-c++ </span><br><span class="line"></span><br><span class="line">yum -y install pcre pcre-devel</span><br><span class="line">yum -y install zlib zlib-devel</span><br><span class="line">yum -y install openssl openssl-devel  </span><br></pre></td></tr></table></figure>



<h3 id="1-Nginx安装"><a href="#1-Nginx安装" class="headerlink" title="1.Nginx安装"></a>1.Nginx安装</h3><p>访问<a target="_blank" rel="noopener" href="http://nginx.org/">nginx</a>下载，并将下载好的包上传服务器。或者你可以在服务器上运行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.24.0.tar.gz</span><br></pre></td></tr></table></figure>

<p>解压安装包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf nginx-1.24.0.tar.gz</span><br></pre></td></tr></table></figure>



<h3 id="2-配置转发规则"><a href="#2-配置转发规则" class="headerlink" title="2.配置转发规则"></a>2.配置转发规则</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">  listen 8001;</span><br><span class="line">  server_name 127.0.0.1;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass  http://172.20.0.1:8002;</span><br><span class="line">    proxy_set_header Host $proxy_host;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问本机8001端口时，将转发到<code>172.20.0.1</code>容器的8002端口</p>

        <!-- 分类文章 -->
        
        
          <div class="post-categoris-bottom">
            
            <div class="post-categoris-name">Docker</div>
            
            <ul>
            
              
            
              
              
                <li class="base">
                  
                  <a  href="/2023/06/05/hello-world/" class="post-categoris-bottom-link">
                  Hello World
                  </a>
                </li>
              
              
            
            
              
            
              
              
            
            
              
            
              
              
                <li class="me base">
                  
                  <a  href="/2023/06/08/micro-services-based-on-Docker-Nginx-FastApi/" class="post-categoris-bottom-link">
                  Docker+FastApi微服务搭建
                  </a>
                </li>
              
              
            
            
            </ul>

          </div>

        
      </div>
      <div class="post-content-inner-space">
        
          <div class="space-toc-main animate__animated  animate__fadeInUp">
            <ol class="space-toc"><li class="space-toc-item space-toc-level-2"><a class="space-toc-link" href="#%E5%89%8D%E8%A8%80"><span class="space-toc-text">前言</span></a><ol class="space-toc-child"><li class="space-toc-item space-toc-level-3"><a class="space-toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%80%9D%E8%B7%AF"><span class="space-toc-text">基本思路</span></a></li><li class="space-toc-item space-toc-level-3"><a class="space-toc-link" href="#%E7%8E%AF%E5%A2%83"><span class="space-toc-text">环境</span></a></li></ol></li><li class="space-toc-item space-toc-level-2"><a class="space-toc-link" href="#%E2%85%A0-Docker%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="space-toc-text">Ⅰ.Docker环境搭建</span></a><ol class="space-toc-child"><li class="space-toc-item space-toc-level-3"><a class="space-toc-link" href="#1-Docker%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="space-toc-text">1.Docker安装与配置</span></a></li><li class="space-toc-item space-toc-level-3"><a class="space-toc-link" href="#2-%E9%95%9C%E5%83%8F%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%90%AF%E7%94%A8"><span class="space-toc-text">2.镜像创建与启用</span></a></li></ol></li><li class="space-toc-item space-toc-level-2"><a class="space-toc-link" href="#%E2%85%A1-%E5%9F%BA%E4%BA%8EFastApi%E7%9A%84%E5%90%8E%E5%8F%B0%E5%BC%80%E5%8F%91"><span class="space-toc-text">Ⅱ.基于FastApi的后台开发</span></a></li><li class="space-toc-item space-toc-level-2"><a class="space-toc-link" href="#%E2%85%A2-Nginx%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="space-toc-text">Ⅲ.Nginx端口转发</span></a><ol class="space-toc-child"><li class="space-toc-item space-toc-level-3"><a class="space-toc-link" href="#1-Nginx%E5%AE%89%E8%A3%85"><span class="space-toc-text">1.Nginx安装</span></a></li><li class="space-toc-item space-toc-level-3"><a class="space-toc-link" href="#2-%E9%85%8D%E7%BD%AE%E8%BD%AC%E5%8F%91%E8%A7%84%E5%88%99"><span class="space-toc-text">2.配置转发规则</span></a></li></ol></li></ol>
           </div>
        
      </div>
   </div>
    <!-- 评论 -->
    
  </div>
</article>
  </div>
</div>



<!-- 如果是home模式的话，不在首页就显示footer，如果不是home模式的话 所有都显示footer -->

  <div class="footer-outer animate__animated  animate__fadeInUp">
    <div class="footer-inner">
    <div class="footer-text">
        <span>Copyright &copy; 2023 慕傅鱼
            <br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & My little brain</span>
    </div>
    <div class="footer-contact">
    <ul class="footer-ul">
        
        <li class="footer-li">
            <a href="https://github.com/LINXIAXING" target="_blank">
                <i class="ri-github-line"></i>
            </a>
        </li>
        
        <li class="footer-li">
            <a href="mailto:tropicalalgae@gmail.com" target="_blank">
                <i class="ri-mail-line"></i>
            </a>
        </li>
        
        <li class="footer-li">
            <a href="1234123\" target="_blank">
                <i class="ri-bilibili-fill"></i>
            </a>
        </li>
        
        <li class="footer-li">
            <a href="https://discord.com/channels/@me/1017335972351987722" target="_blank">
                <i class="ri-discord-line"></i>
            </a>
        </li>
        
        <li class="footer-li">
            <a href="baidu.com" target="_blank">
                <i class="ri-booklet-line"></i>
            </a>
        </li>
        
    </ul>
    </div>
    </div>
</div>






<script src="/js/white.js"></script>



</body>
</html>
